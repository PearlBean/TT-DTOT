<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªá th·ªëng gi√°m s√°t ph∆∞∆°ng ti·ªán th√¥ng minh</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      body {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f0f4f8;
        height: 100%;
      }

      html {
        height: 100%;
      }

      .sidebar {
        background: linear-gradient(180deg, #1e3a8a 0%, #1e40af 100%);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .nav-item {
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
      }

      .nav-item.active {
        background: rgba(255, 255, 255, 0.15);
        border-left: 4px solid #60a5fa;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
      }

      .status-badge {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .status-normal {
        background: #dcfce7;
        color: #166534;
      }

      .status-warning {
        background: #fed7aa;
        color: #9a3412;
      }

      .status-danger {
        background: #fecaca;
        color: #991b1b;
      }

      .chart-container {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
      }

      .pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }

        50% {
          opacity: 0.5;
        }
      }

      .vehicle-row {
        transition: background 0.2s ease;
      }

      .vehicle-row:hover {
        background: #f9fafb;
      }

      .btn-primary {
        background: #2563eb;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s ease;
      }

      .btn-primary:hover {
        background: #1d4ed8;
      }

      .btn-secondary {
        background: #64748b;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s ease;
      }

      .btn-secondary:hover {
        background: #475569;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        border-radius: 12px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 90%;
        overflow-y: auto;
      }

      .form-input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        transition: border 0.2s ease;
      }

      .form-input:focus {
        outline: none;
        border-color: #2563eb;
      }

      .gauge {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: conic-gradient(#2563eb 0deg, #e5e7eb 0deg);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .gauge-inner {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .login-container {
        min-height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .login-box {
        background: white;
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
      }

      .alert-item {
        background: white;
        border-left: 4px solid #ef4444;
        padding: 16px;
        margin-bottom: 12px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.06);
      }

      .loading-spinner {
        border: 3px solid #f3f4f6;
        border-top: 3px solid #2563eb;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-left: 8px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
  </head>

  <body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
      <div class="login-box">
        <div class="text-center mb-8">
          <div class="text-5xl mb-4">üöó</div>
          <h1 id="systemTitle" class="text-3xl font-bold text-gray-800 mb-2">
            Gi√°m s√°t xe c·ªßa t√¥i
          </h1>
          <p class="text-gray-600">Theo d√µi t·ªëc ƒë·ªô v√† √°p su·∫•t l·ªëp xe</p>
        </div>
        <form id="loginForm" class="space-y-4">
          <div>
            <label
              for="loginEmail"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >Email</label
            >
            <input
              id="loginEmail"
              class="form-input"
              placeholder="Nh·∫≠p bi·ªÉn s·ªë xe 51F-123.45"
              required
            />
          </div>
          <div>
            <label
              for="loginPassword"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >M·∫≠t kh·∫©u</label
            >
            <input
              type="password"
              id="loginPassword"
              class="form-input"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
            />
          </div>
          <button type="submit" class="btn-primary w-full">ƒêƒÉng nh·∫≠p</button>
          <div class="text-center space-y-2 mt-4">
            <a href="#" class="text-sm text-blue-600 hover:underline block"
              >Qu√™n m·∫≠t kh·∫©u?</a
            >
            <a href="#" class="text-sm text-blue-600 hover:underline block"
              >ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi</a
            >
          </div>
        </form>
      </div>
    </div>
    <!-- Main Dashboard -->
    <div id="mainApp" style="display: none; height: 100%">
      <div class="flex" style="height: 100%">
        <!-- Sidebar -->
        <div class="sidebar w-64 text-white flex-shrink-0">
          <div class="p-6">
            <div class="text-2xl font-bold mb-2">üöó Xe c·ªßa t√¥i</div>
            <p class="text-sm text-blue-200">Theo d√µi th·ªùi gian th·ª±c</p>
          </div>
          <nav class="mt-6">
            <div
              class="nav-item active px-6 py-3 flex items-center space-x-3"
              data-page="dashboard"
            >
              <span class="text-xl">üìä</span>
              <span class="font-semibold">T·ªïng quan</span>
            </div>
            <div
              class="nav-item px-6 py-3 flex items-center space-x-3"
              data-page="vehicles"
            >
              <span class="text-xl">üöó</span>
              <span class="font-semibold">Xe c·ªßa t√¥i</span>
            </div>
            <div
              class="nav-item px-6 py-3 flex items-center space-x-3"
              data-page="history"
            >
              <span class="text-xl">üìà</span>
              <span class="font-semibold">L·ªãch s·ª≠</span>
            </div>
            <div
              class="nav-item px-6 py-3 flex items-center space-x-3"
              data-page="alerts"
            >
              <span class="text-xl">‚ö†Ô∏è</span>
              <span class="font-semibold">C·∫£nh b√°o</span>
            </div>
            <div
              class="nav-item px-6 py-3 flex items-center space-x-3"
              data-page="settings"
            >
              <span class="text-xl">‚öôÔ∏è</span>
              <span class="font-semibold">C√†i ƒë·∫∑t</span>
            </div>
          </nav>
          <div class="absolute bottom-0 w-64 p-6 border-t border-blue-700">
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 bg-blue-300 rounded-full flex items-center justify-center text-blue-900 font-bold"
              >
                N
              </div>
              <div>
                <div class="font-semibold">Nguy·ªÖn VƒÉn A</div>
                <button
                  id="logoutBtn"
                  class="text-xs text-blue-200 hover:underline"
                >
                  ƒêƒÉng xu·∫•t
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
          <!-- Dashboard Page -->
          <div id="dashboardPage" class="page-content p-8">
            <div class="mb-6">
              <h1
                id="dashboardTitle"
                class="text-3xl font-bold text-gray-800 mb-2"
              >
                T·ªïng quan xe c·ªßa t√¥i
              </h1>
              <p id="welcomeMessage" class="text-gray-600">
                Theo d√µi t·ªëc ƒë·ªô v√† √°p su·∫•t l·ªëp theo th·ªùi gian th·ª±c
              </p>
              <div class="flex items-center mt-2">
                <span
                  class="w-3 h-3 bg-green-500 rounded-full pulse mr-2"
                ></span>
                <span class="text-sm text-gray-600">ƒêang k·∫øt n·ªëi v·ªõi xe</span>
              </div>
            </div>
            <!-- Stats Cards -->
            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
            >
              <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-gray-600 text-sm font-semibold">S·ªë xe</span>
                  <span class="text-2xl">üöó</span>
                </div>
                <div
                  class="text-3xl font-bold text-gray-800"
                  id="activeVehicles"
                >
                  0
                </div>
                <div class="text-xs text-green-600 mt-1">Xe ƒëang theo d√µi</div>
              </div>
              <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-gray-600 text-sm font-semibold"
                    >C·∫£nh b√°o</span
                  >
                  <span class="text-2xl">‚ö†Ô∏è</span>
                </div>
                <div class="text-3xl font-bold text-orange-600" id="alertCount">
                  0
                </div>
                <div class="text-xs text-orange-600 mt-1" id="alertStatus">
                  Kh√¥ng c√≥ c·∫£nh b√°o
                </div>
              </div>
              <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-gray-600 text-sm font-semibold"
                    >T·ªëc ƒë·ªô hi·ªán t·∫°i</span
                  >
                  <span class="text-2xl">‚ö°</span>
                </div>
                <div class="text-3xl font-bold text-blue-600" id="avgSpeed">
                  0
                </div>
                <div class="text-xs text-gray-500 mt-1">km/h</div>
              </div>
              <div class="stat-card">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-gray-600 text-sm font-semibold"
                    >√Åp su·∫•t l·ªëp</span
                  >
                  <span class="text-2xl">üîß</span>
                </div>
                <div
                  class="text-3xl font-bold text-purple-600"
                  id="avgPressure"
                >
                  0
                </div>
                <div class="text-xs text-gray-500 mt-1">PSI</div>
              </div>
            </div>
            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              <div class="chart-container">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                  Bi·ªÉu ƒë·ªì t·ªëc ƒë·ªô theo th·ªùi gian
                </h3>
                <div
                  id="speedChart"
                  class="h-64 flex items-center justify-center text-gray-400"
                >
                  D·ªØ li·ªáu s·∫Ω hi·ªÉn th·ªã khi c√≥ xe ho·∫°t ƒë·ªông
                </div>
              </div>
              <div class="chart-container">
                <h3 class="text-lg font-bold text-gray-800 mb-4">
                  Bi·ªÉu ƒë·ªì √°p su·∫•t l·ªëp
                </h3>
                <div
                  id="pressureChart"
                  class="h-64 flex items-center justify-center text-gray-400"
                >
                  D·ªØ li·ªáu s·∫Ω hi·ªÉn th·ªã khi c√≥ xe ho·∫°t ƒë·ªông
                </div>
              </div>
            </div>
            <!-- Vehicle Table -->
            <div class="chart-container">
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">Xe c·ªßa t√¥i</h3>
                <button id="addVehicleBtn" class="btn-primary">
                  + Th√™m xe
                </button>
              </div>
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead>
                    <tr class="border-b-2 border-gray-200">
                      <th
                        class="text-left py-3 px-4 text-sm font-semibold text-gray-700"
                      >
                        T√™n xe
                      </th>
                      <th
                        class="text-left py-3 px-4 text-sm font-semibold text-gray-700"
                      >
                        T·ªëc ƒë·ªô
                      </th>
                      <th
                        class="text-left py-3 px-4 text-sm font-semibold text-gray-700"
                      >
                        √Åp su·∫•t
                      </th>
                      <th
                        class="text-left py-3 px-4 text-sm font-semibold text-gray-700"
                      >
                        Tr·∫°ng th√°i
                      </th>
                      <th
                        class="text-left py-3 px-4 text-sm font-semibold text-gray-700"
                      >
                        C·∫£nh b√°o
                      </th>
                      <th
                        class="text-left py-3 px-4 text-sm font-semibold text-gray-700"
                      >
                        Thao t√°c
                      </th>
                    </tr>
                  </thead>
                  <tbody id="vehicleTableBody">
                    <tr>
                      <td colspan="6" class="text-center py-8 text-gray-400">
                        Ch∆∞a c√≥ xe n√†o. Nh·∫•n "Th√™m xe" ƒë·ªÉ b·∫Øt ƒë·∫ßu theo d√µi.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Vehicles Page -->
          <div id="vehiclesPage" class="page-content p-8" style="display: none">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-800 mb-2">Xe c·ªßa t√¥i</h1>
              <p class="text-gray-600">Qu·∫£n l√Ω v√† theo d√µi c√°c xe c·ªßa b·∫°n</p>
            </div>
            <div class="chart-container">
              <div class="flex justify-between items-center mb-4">
                <div class="flex space-x-4">
                  <input
                    type="text"
                    id="searchVehicle"
                    class="form-input"
                    placeholder="üîç T√¨m ki·∫øm xe..."
                  />
                </div>
                <button id="addVehicleBtn2" class="btn-primary">
                  + Th√™m xe
                </button>
              </div>
              <div
                id="vehicleGrid"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <div class="text-center py-12 text-gray-400 col-span-full">
                  Ch∆∞a c√≥ xe n√†o. Th√™m xe ƒë·ªÉ b·∫Øt ƒë·∫ßu gi√°m s√°t.
                </div>
              </div>
            </div>
          </div>
          <!-- History Page -->
          <div id="historyPage" class="page-content p-8" style="display: none">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-800 mb-2">L·ªãch s·ª≠</h1>
              <p class="text-gray-600">
                Xem l·∫°i d·ªØ li·ªáu t·ªëc ƒë·ªô v√† √°p su·∫•t theo th·ªùi gian
              </p>
            </div>
            <div class="chart-container mb-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">B·ªô l·ªçc</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Ch·ªçn xe</label
                  >
                  <select id="historyVehicleFilter" class="form-input">
                    <option value="">T·∫•t c·∫£ xe</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >T·ª´ ng√†y</label
                  >
                  <input type="date" id="historyDateFrom" class="form-input" />
                </div>
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >ƒê·∫øn ng√†y</label
                  >
                  <input type="date" id="historyDateTo" class="form-input" />
                </div>
              </div>
              <button id="applyHistoryFilter" class="btn-primary mt-4">
                √Åp d·ª•ng b·ªô l·ªçc
              </button>
              <button id="exportCSV" class="btn-secondary mt-4 ml-2">
                üì• T·∫£i CSV
              </button>
            </div>
            <div class="chart-container">
              <h3 class="text-lg font-bold text-gray-800 mb-4">
                Bi·ªÉu ƒë·ªì l·ªãch s·ª≠
              </h3>
              <div
                id="historyChart"
                class="h-96 flex items-center justify-center text-gray-400"
              >
                Ch·ªçn b·ªô l·ªçc v√† nh·∫•n "√Åp d·ª•ng" ƒë·ªÉ xem d·ªØ li·ªáu
              </div>
            </div>
          </div>
          <!-- Alerts Page -->
          <div id="alertsPage" class="page-content p-8" style="display: none">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-800 mb-2">C·∫£nh b√°o</h1>
              <p class="text-gray-600">C√°c c·∫£nh b√°o v·ªÅ t·ªëc ƒë·ªô v√† √°p su·∫•t l·ªëp</p>
            </div>
            <div class="chart-container mb-6">
              <div class="flex space-x-4">
                <button
                  class="px-4 py-2 rounded-lg bg-blue-100 text-blue-700 font-semibold"
                  id="filterAll"
                >
                  T·∫•t c·∫£
                </button>
                <button
                  class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100"
                  id="filterActive"
                >
                  ƒêang ho·∫°t ƒë·ªông
                </button>
                <button
                  class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100"
                  id="filterResolved"
                >
                  ƒê√£ x·ª≠ l√Ω
                </button>
              </div>
            </div>
            <div id="alertsList" class="space-y-4">
              <div class="text-center py-12 text-gray-400">
                Kh√¥ng c√≥ c·∫£nh b√°o n√†o
              </div>
            </div>
          </div>
          <!-- Settings Page -->
          <div id="settingsPage" class="page-content p-8" style="display: none">
            <div class="mb-6">
              <h1 class="text-3xl font-bold text-gray-800 mb-2">C√†i ƒë·∫∑t</h1>
              <p class="text-gray-600">
                C·∫•u h√¨nh ng∆∞·ª°ng c·∫£nh b√°o cho xe c·ªßa b·∫°n
              </p>
            </div>
            <div class="chart-container mb-6">
              <h3 class="text-lg font-bold text-gray-800 mb-4">
                Ng∆∞·ª°ng c·∫£nh b√°o
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-gray-700 mb-2"
                    >Ch·ªçn xe</label
                  >
                  <select id="settingsVehicleSelect" class="form-input">
                    <option value="">Ch·ªçn xe ƒë·ªÉ c·∫•u h√¨nh</option>
                  </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-700 mb-2"
                      >Ng∆∞·ª°ng t·ªëc ƒë·ªô t·ªëi ƒëa (km/h)</label
                    >
                    <input
                      type="number"
                      id="maxSpeedThreshold"
                      class="form-input"
                      placeholder="120"
                      value="120"
                    />
                  </div>
                  <div>
                    <label
                      class="block text-sm font-semibold text-gray-700 mb-2"
                      >Ng∆∞·ª°ng √°p su·∫•t t·ªëi thi·ªÉu (PSI)</label
                    >
                    <input
                      type="number"
                      id="minPressureThreshold"
                      class="form-input"
                      placeholder="30"
                      value="30"
                    />
                  </div>
                </div>
                <button id="saveThresholds" class="btn-primary">
                  üíæ L∆∞u c√†i ƒë·∫∑t
                </button>
              </div>
            </div>
            <div class="chart-container">
              <h3 class="text-lg font-bold text-gray-800 mb-4">Th√¥ng b√°o</h3>
              <div class="space-y-4">
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="emailNotif"
                    class="w-4 h-4 text-blue-600"
                    checked
                  />
                  <label for="emailNotif" class="ml-2 text-gray-700"
                    >Nh·∫≠n th√¥ng b√°o qua Email</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="webNotif"
                    class="w-4 h-4 text-blue-600"
                    checked
                  />
                  <label for="webNotif" class="ml-2 text-gray-700"
                    >Nh·∫≠n th√¥ng b√°o tr√™n Web</label
                  >
                </div>
                <button id="saveNotifSettings" class="btn-primary">
                  üíæ L∆∞u c√†i ƒë·∫∑t th√¥ng b√°o
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Add Vehicle Modal -->
    <div id="addVehicleModal" class="modal">
      <div class="modal-content">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Th√™m xe c·ªßa t√¥i</h2>
        <form id="addVehicleForm" class="space-y-4">
          <div>
            <label
              for="vehicleName"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >T√™n xe</label
            >
            <input
              type="text"
              id="vehicleName"
              class="form-input"
              placeholder="V√≠ d·ª•: Xe t·∫£i 01"
              required
            />
          </div>
          <div>
            <label
              for="vehicleSpeed"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >T·ªëc ƒë·ªô hi·ªán t·∫°i (km/h)</label
            >
            <input
              type="number"
              id="vehicleSpeed"
              class="form-input"
              placeholder="60"
              required
            />
          </div>
          <div>
            <label
              for="vehiclePressure"
              class="block text-sm font-semibold text-gray-700 mb-2"
              >√Åp su·∫•t l·ªëp (PSI)</label
            >
            <input
              type="number"
              id="vehiclePressure"
              class="form-input"
              placeholder="32"
              required
            />
          </div>
          <div class="flex space-x-3 mt-6">
            <button type="submit" class="btn-primary flex-1">
              <span id="addVehicleText">Th√™m xe</span>
            </button>
            <button
              type="button"
              id="cancelAddVehicle"
              class="btn-secondary flex-1"
            >
              H·ªßy
            </button>
          </div>
        </form>
      </div>
    </div>
    <script>
      const defaultConfig = {
        system_title: "H·ªá th·ªëng gi√°m s√°t ph∆∞∆°ng ti·ªán th√¥ng minh",
        dashboard_title: "T·ªïng quan h·ªá th·ªëng",
        welcome_message: "Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng gi√°m s√°t",
        primary_color: "#2563eb",
        secondary_color: "#1e3a8a",
        text_color: "#1f2937",
        background_color: "#f0f4f8",
        accent_color: "#ef4444",
      };

      let currentPage = "dashboard";
      let isLoggedIn = false;
      let vehicleData = [];

      // ===== STATE CHO REALTIME CHART =====
      let telemetryHistory = []; // l·ªãch s·ª≠ m·∫´u ƒë·ªçc t·ª´ server (REST + WS)

      let speedChart; // instance Chart.js cho t·ªëc ƒë·ªô
      let pressureChart; // instance Chart.js cho √°p su·∫•t

      let chartLabels = []; // tr·ª•c th·ªùi gian
      let chartSpeed = []; // data t·ªëc ƒë·ªô
      let chartPressure = []; // data √°p su·∫•t (PSI)
      const MAX_POINTS = 50; // gi·ªØ t·ªëi ƒëa 50 ƒëi·ªÉm tr√™n ƒë·ªì th·ªã

      const dataHandler = {
        onDataChanged(data) {
          vehicleData = data;
          updateDashboard();
          updateVehicleTable();
          updateVehicleGrid();
          updateAlertsList();
          updateHistoryFilters();
          updateSettingsFilters();
        },
      };

      async function initApp() {
        // SDK c≈© ‚Äì n·∫øu c√≥
        if (window.dataSdk) {
          const initResult = await window.dataSdk.init(dataHandler);
          if (!initResult.isOk) {
            console.error("Failed to initialize data SDK");
          }
        }

        if (window.elementSdk) {
          window.elementSdk.init({
            defaultConfig,
            onConfigChange: async (config) => {
              const systemTitle = document.getElementById("systemTitle");
              const dashboardTitle = document.getElementById("dashboardTitle");
              const welcomeMessage = document.getElementById("welcomeMessage");

              if (systemTitle)
                systemTitle.textContent =
                  config.system_title || defaultConfig.system_title;
              if (dashboardTitle)
                dashboardTitle.textContent =
                  config.dashboard_title || defaultConfig.dashboard_title;
              if (welcomeMessage)
                welcomeMessage.textContent =
                  config.welcome_message || defaultConfig.welcome_message;

              document.documentElement.style.setProperty(
                "--primary-color",
                config.primary_color || defaultConfig.primary_color
              );
              document.documentElement.style.setProperty(
                "--secondary-color",
                config.secondary_color || defaultConfig.secondary_color
              );
            },
            mapToCapabilities: (config) => ({
              recolorables: [
                {
                  get: () =>
                    config.background_color || defaultConfig.background_color,
                  set: (value) => {
                    if (window.elementSdk) {
                      window.elementSdk.config.background_color = value;
                      window.elementSdk.setConfig({ background_color: value });
                    }
                  },
                },
                {
                  get: () =>
                    config.secondary_color || defaultConfig.secondary_color,
                  set: (value) => {
                    if (window.elementSdk) {
                      window.elementSdk.config.secondary_color = value;
                      window.elementSdk.setConfig({ secondary_color: value });
                    }
                  },
                },
                {
                  get: () => config.text_color || defaultConfig.text_color,
                  set: (value) => {
                    if (window.elementSdk) {
                      window.elementSdk.config.text_color = value;
                      window.elementSdk.setConfig({ text_color: value });
                    }
                  },
                },
                {
                  get: () =>
                    config.primary_color || defaultConfig.primary_color,
                  set: (value) => {
                    if (window.elementSdk) {
                      window.elementSdk.config.primary_color = value;
                      window.elementSdk.setConfig({ primary_color: value });
                    }
                  },
                },
                {
                  get: () => config.accent_color || defaultConfig.accent_color,
                  set: (value) => {
                    if (window.elementSdk) {
                      window.elementSdk.config.accent_color = value;
                      window.elementSdk.setConfig({ accent_color: value });
                    }
                  },
                },
              ],
              borderables: [],
              fontEditable: undefined,
              fontSizeable: undefined,
            }),
            mapToEditPanelValues: (config) =>
              new Map([
                [
                  "system_title",
                  config.system_title || defaultConfig.system_title,
                ],
                [
                  "dashboard_title",
                  config.dashboard_title || defaultConfig.dashboard_title,
                ],
                [
                  "welcome_message",
                  config.welcome_message || defaultConfig.welcome_message,
                ],
              ]),
          });
        }

        setupEventListeners();

        // ==== PH·∫¶N M·ªöI: l·∫•y l·ªãch s·ª≠ + m·ªü WebSocket realtime ====
        loadInitialHistory();
        connectDashboardWS();
      }

      /* ========= FORMAT TH·ªúI GIAN + CHART REALTIME ========= */

      // Format th·ªùi gian tr√™n tr·ª•c X
      function formatTimeLabel(ts) {
        const d = new Date(ts);
        return d.toLocaleTimeString("vi-VN", { hour12: false });
      }

      // T·∫°o 2 bi·ªÉu ƒë·ªì l·∫ßn ƒë·∫ßu d·ª±a tr√™n telemetryHistory
      function initRealtimeCharts() {
        const speedDiv = document.getElementById("speedChart");
        const pressureDiv = document.getElementById("pressureChart");
        if (!speedDiv || !pressureDiv) return;

        // Clear placeholder v√† ch√®n canvas
        speedDiv.innerHTML = '<canvas id="speedChartCanvas"></canvas>';
        pressureDiv.innerHTML = '<canvas id="pressureChartCanvas"></canvas>';

        const ctxSpeed = document
          .getElementById("speedChartCanvas")
          .getContext("2d");
        const ctxPressure = document
          .getElementById("pressureChartCanvas")
          .getContext("2d");

        // L·∫•y t·ªëi ƒëa 50 ƒëi·ªÉm g·∫ßn nh·∫•t, s·∫Øp x·∫øp theo th·ªùi gian tƒÉng d·∫ßn
        const samples = [...telemetryHistory]
          .sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp))
          .slice(-MAX_POINTS);

        chartLabels = samples.map((s) =>
          formatTimeLabel(s.timestamp || Date.now())
        );
        chartSpeed = samples.map((s) => s.speedKmh ?? 0);
        chartPressure = samples.map((s) => (s.pressureBar ?? 0) * 14.5038); // bar ‚Üí PSI

        speedChart = new Chart(ctxSpeed, {
          type: "line",
          data: {
            labels: chartLabels,
            datasets: [
              {
                label: "T·ªëc ƒë·ªô (km/h)",
                data: chartSpeed,
                fill: false,
                tension: 0.2,
              },
            ],
          },
          options: {
            animation: false,
            responsive: true,
            scales: {
              x: { display: true, title: { display: true, text: "Th·ªùi gian" } },
              y: { beginAtZero: true, title: { display: true, text: "km/h" } },
            },
          },
        });

        pressureChart = new Chart(ctxPressure, {
          type: "line",
          data: {
            labels: chartLabels,
            datasets: [
              {
                label: "√Åp su·∫•t (PSI)",
                data: chartPressure,
                fill: false,
                tension: 0.2,
              },
            ],
          },
          options: {
            animation: false,
            responsive: true,
            scales: {
              x: { display: true, title: { display: true, text: "Th·ªùi gian" } },
              y: { beginAtZero: true, title: { display: true, text: "PSI" } },
            },
          },
        });
      }

      // Th√™m 1 m·∫´u m·ªõi v√†o 2 bi·ªÉu ƒë·ªì realtime
      function pushTelemetryToCharts(sample) {
        if (!speedChart || !pressureChart) return; // ch∆∞a init

        const label = formatTimeLabel(sample.timestamp || Date.now());
        const speed = sample.speedKmh ?? 0;
        const psi = (sample.pressureBar ?? 0) * 14.5038;

        chartLabels.push(label);
        chartSpeed.push(speed);
        chartPressure.push(psi);

        // Gi·ªõi h·∫°n s·ªë ƒëi·ªÉm
        if (chartLabels.length > MAX_POINTS) {
          chartLabels.shift();
          chartSpeed.shift();
          chartPressure.shift();
        }

        // C·∫≠p nh·∫≠t data cho chart
        speedChart.data.labels = chartLabels;
        speedChart.data.datasets[0].data = chartSpeed;
        speedChart.update("none"); // t·∫Øt animation

        pressureChart.data.labels = chartLabels;
        pressureChart.data.datasets[0].data = chartPressure;
        pressureChart.update("none");
      }

      /* ========= L·ªäCH S·ª¨ (REST /history) ========= */

      async function loadInitialHistory() {
        try {
          const res = await fetch("/history?limit=100");
          if (!res.ok) {
            console.warn("[History] HTTP", res.status);
            initRealtimeCharts(); // v·∫´n t·∫°o chart r·ªóng
            return;
          }
          const list = await res.json();
          telemetryHistory = Array.isArray(list) ? list : [];

          renderHistoryTable();

          // Kh·ªüi t·∫°o bi·ªÉu ƒë·ªì t·ª´ l·ªãch s·ª≠ (n·∫øu c√≥), n·∫øu kh√¥ng th√¨ v·∫´n init r·ªóng
          initRealtimeCharts();

          if (telemetryHistory.length > 0) {
            // M·∫´u m·ªõi nh·∫•t (docs server tr·∫£ sort -1)
            updateRealtimeFromTelemetry(telemetryHistory[0]);
          }
        } catch (e) {
          console.error("[History] load error:", e);
          initRealtimeCharts();
        }
      }

      // V·∫Ω b·∫£ng l·ªãch s·ª≠ ·ªü tab "L·ªãch s·ª≠"
      function renderHistoryTable() {
        const container = document.getElementById("historyChart");
        if (!container) return;

        if (!telemetryHistory.length) {
          container.innerHTML = `
            <div class="h-96 flex items-center justify-center text-gray-400">
                Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠.
            </div>
        `;
          return;
        }

        const rows = telemetryHistory
          .map((item) => {
            const t = new Date(item.timestamp || Date.now()).toLocaleString(
              "vi-VN"
            );
            const speed = (item.speedKmh ?? 0).toFixed(1);
            const bar = item.pressureBar ?? 0;
            const psi = (bar * 14.5038).toFixed(1);
            const alert =
              item.overMax || item.underMin ? "‚ö† C·∫£nh b√°o" : "‚úì B√¨nh th∆∞·ªùng";

            return `
            <tr class="border-b border-gray-100">
                <td class="px-4 py-2">${t}</td>
                <td class="px-4 py-2 text-right">${speed}</td>
                <td class="px-4 py-2 text-right">${psi}</td>
                <td class="px-4 py-2 text-center">${alert}</td>
            </tr>
        `;
          })
          .join("");

        container.innerHTML = `
        <div class="overflow-x-auto w-full">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b-2 border-gray-200">
                        <th class="px-4 py-2 text-left">Th·ªùi gian</th>
                        <th class="px-4 py-2 text-right">T·ªëc ƒë·ªô (km/h)</th>
                        <th class="px-4 py-2 text-right">√Åp su·∫•t (PSI)</th>
                        <th class="px-4 py-2 text-center">C·∫£nh b√°o</th>
                    </tr>
                </thead>
                <tbody>
                    ${rows}
                </tbody>
            </table>
        </div>
    `;
      }

      /* ========= WEBSOCKET DASHBOARD <-> SERVER ========= */

      function connectDashboardWS() {
        const loc = window.location;
        const proto = loc.protocol === "https:" ? "wss" : "ws";
        const wsUrl = `${proto}://${loc.host}/ws`;

        const ws = new WebSocket(wsUrl);

        ws.onopen = () => {
          ws.send(JSON.stringify({ type: "dashboard_subscribe" }));
          console.log("[WS] Dashboard connected");
        };

        ws.onmessage = (event) => {
          try {
            const data = JSON.parse(event.data);
            if (data.type === "telemetry_update") {
              // Ch·ªâ nh·∫≠n d·ªØ li·ªáu c·ªßa bi·ªÉn s·ªë ƒëang ƒëƒÉng nh·∫≠p
              if (
                !window.currentPlate ||
                data.licensePlate !== window.currentPlate
              ) {
                return; // b·ªè qua xe kh√°c
              }

              telemetryHistory.unshift(data);
              if (telemetryHistory.length > 200) telemetryHistory.pop();

              updateRealtimeFromTelemetry(data);
              renderHistoryTable();
            }
          } catch (e) {
            console.error("[WS] parse error:", e);
          }
        };

        ws.onerror = (err) => {
          console.error("[WS] error:", err);
        };

        ws.onclose = () => {
          console.warn("[WS] closed");
          // n·∫øu mu·ªën auto reconnect th√¨ th√™m logic ·ªü ƒë√¢y
        };
      }

      /* ========= C·∫¨P NH·∫¨T DASHBOARD T·ª™ 1 M·∫™U TELEMETRY ========= */

      function updateRealtimeFromTelemetry(item) {
        // ƒê·∫£m b·∫£o chart ƒë√£ ƒë∆∞·ª£c t·∫°o
        if (!speedChart || !pressureChart) {
          initRealtimeCharts();
        }

        // ƒê·∫©y ƒëi·ªÉm m·ªõi v√†o 2 ƒë·ªì th·ªã
        pushTelemetryToCharts(item);

        const speed = item.speedKmh ?? 0;
        const bar = item.pressureBar ?? 0;
        const psi = bar * 14.5038;

        const avgSpeedEl = document.getElementById("avgSpeed");
        const avgPressureEl = document.getElementById("avgPressure");
        const activeVehiclesEl = document.getElementById("activeVehicles");
        const alertCountEl = document.getElementById("alertCount");
        const alertStatusEl = document.getElementById("alertStatus");

        if (avgSpeedEl) avgSpeedEl.textContent = speed.toFixed(1);
        if (avgPressureEl) avgPressureEl.textContent = psi.toFixed(1);

        // T·∫°m coi nh∆∞ ƒëang theo d√µi 1 xe
        if (activeVehiclesEl) activeVehiclesEl.textContent = "1";

        const hasAlert = item.overMax || item.underMin;
        if (alertCountEl) alertCountEl.textContent = hasAlert ? "1" : "0";

        if (alertStatusEl) {
          if (hasAlert) {
            alertStatusEl.textContent = "C√≥ c·∫£nh b√°o";
            alertStatusEl.className = "text-xs text-orange-600 mt-1";
          } else {
            alertStatusEl.textContent = "Kh√¥ng c√≥ c·∫£nh b√°o";
            alertStatusEl.className = "text-xs text-green-600 mt-1";
          }
        }
      }

      /* ========= PH·∫¶N C≈®: UI, XE DEMO, C√ÄI ƒê·∫∂T ========= */

      function setupEventListeners() {
        const loginForm = document.getElementById("loginForm");
        if (loginForm) {
          loginForm.addEventListener("submit", (e) => {
            e.preventDefault();
            login();
          });
        }

        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", logout);
        }

        document.querySelectorAll(".nav-item").forEach((item) => {
          item.addEventListener("click", () => {
            const page = item.dataset.page;
            navigateToPage(page);
          });
        });

        const addVehicleBtn = document.getElementById("addVehicleBtn");
        const addVehicleBtn2 = document.getElementById("addVehicleBtn2");
        if (addVehicleBtn)
          addVehicleBtn.addEventListener("click", openAddVehicleModal);
        if (addVehicleBtn2)
          addVehicleBtn2.addEventListener("click", openAddVehicleModal);

        const cancelAddVehicle = document.getElementById("cancelAddVehicle");
        if (cancelAddVehicle) {
          cancelAddVehicle.addEventListener("click", closeAddVehicleModal);
        }

        const addVehicleForm = document.getElementById("addVehicleForm");
        if (addVehicleForm) {
          addVehicleForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            await addVehicle();
          });
        }

        const saveThresholds = document.getElementById("saveThresholds");
        if (saveThresholds) {
          saveThresholds.addEventListener("click", saveThresholdSettings);
        }

        const saveNotifSettings = document.getElementById("saveNotifSettings");
        if (saveNotifSettings) {
          saveNotifSettings.addEventListener("click", saveNotificationSettings);
        }

        const exportCSV = document.getElementById("exportCSV");
        if (exportCSV) {
          exportCSV.addEventListener("click", exportToCSV);
        }
      }

      async function login() {
        const plateInput = document
          .getElementById("loginPlate")
          .value.trim()
          .toUpperCase();
        const passInput = document.getElementById("loginPassword").value.trim();

        if (passInput !== "123123") {
          showToast("Sai m·∫≠t kh·∫©u!", "error");
          return;
        }

        if (!plateInput) {
          showToast("Vui l√≤ng nh·∫≠p bi·ªÉn s·ªë xe!", "error");
          return;
        }

        try {
          const res = await fetch(
            `/check-plate?plate=${encodeURIComponent(plateInput)}`
          );
          const data = await res.json();

          if (!data.exists) {
            showToast("Bi·ªÉn s·ªë xe kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng!", "error");
            return;
          }

          // ƒê√∫ng bi·ªÉn s·ªë, ƒë√∫ng m·∫≠t kh·∫©u ‚Üí ƒêƒÉng nh·∫≠p
          window.currentPlate = plateInput; // l∆∞u bi·ªÉn s·ªë hi·ªán t·∫°i
          isLoggedIn = true;

          document.getElementById("loginPage").style.display = "none";
          document.getElementById("mainApp").style.display = "block";

          showToast(`ƒêƒÉng nh·∫≠p th√†nh c√¥ng: ${plateInput}`, "success");

          // Load ƒë√∫ng l·ªãch s·ª≠ c·ªßa xe ƒë√≥
          loadInitialHistory();
        } catch (err) {
          console.error(err);
          showToast("Kh√¥ng th·ªÉ k·∫øt n·ªëi server!", "error");
        }
      }

      function logout() {
        isLoggedIn = false;
        document.getElementById("loginPage").style.display = "flex";
        document.getElementById("mainApp").style.display = "none";
      }

      function navigateToPage(page) {
        document
          .querySelectorAll(".page-content")
          .forEach((p) => (p.style.display = "none"));
        document
          .querySelectorAll(".nav-item")
          .forEach((item) => item.classList.remove("active"));

        const pageElement = document.getElementById(page + "Page");
        if (pageElement) pageElement.style.display = "block";

        const navItem = document.querySelector(
          `.nav-item[data-page="${page}"]`
        );
        if (navItem) navItem.classList.add("active");

        currentPage = page;
      }

      function openAddVehicleModal() {
        document.getElementById("addVehicleModal").classList.add("active");
      }

      function closeAddVehicleModal() {
        document.getElementById("addVehicleModal").classList.remove("active");
        document.getElementById("addVehicleForm").reset();
      }

      async function addVehicle() {
        if (vehicleData.length >= 999) {
          showToast(
            "ƒê√£ ƒë·∫°t gi·ªõi h·∫°n 999 xe. Vui l√≤ng x√≥a b·ªõt xe tr∆∞·ªõc khi th√™m m·ªõi.",
            "error"
          );
          return;
        }

        const name = document.getElementById("vehicleName").value;
        const speed = parseFloat(document.getElementById("vehicleSpeed").value);
        const pressure = parseFloat(
          document.getElementById("vehiclePressure").value
        );

        const submitBtn = document.querySelector(
          '#addVehicleForm button[type="submit"]'
        );
        const btnText = document.getElementById("addVehicleText");
        const originalText = btnText.textContent;

        submitBtn.disabled = true;
        btnText.innerHTML =
          'ƒêang th√™m... <span class="loading-spinner"></span>';

        const alertLevel = getAlertLevel(speed, pressure);
        const status = alertLevel === "normal" ? "active" : "warning";

        const newVehicle = {
          id: "vehicle_" + Date.now(),
          vehicle_name: name,
          speed: speed,
          pressure: pressure,
          status: status,
          alert_level: alertLevel,
          timestamp: new Date().toISOString(),
          latitude: 21.0285 + (Math.random() - 0.5) * 0.1,
          longitude: 105.8542 + (Math.random() - 0.5) * 0.1,
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(newVehicle);

          submitBtn.disabled = false;
          btnText.textContent = originalText;

          if (result.isOk) {
            closeAddVehicleModal();
            showToast("ƒê√£ th√™m xe th√†nh c√¥ng!", "success");
          } else {
            showToast("L·ªói khi th√™m xe. Vui l√≤ng th·ª≠ l·∫°i.", "error");
          }
        } else {
          // demo offline: ch·ªâ ƒë√≥ng modal
          submitBtn.disabled = false;
          btnText.textContent = originalText;
          closeAddVehicleModal();
          showToast("Demo: ƒë√£ nh·∫≠p xe (kh√¥ng l∆∞u backend).", "success");
        }
      }

      function getAlertLevel(speed, pressure) {
        if (speed > 120 || pressure < 30) return "danger";
        if (speed > 100 || pressure < 32) return "warning";
        return "normal";
      }

      function updateDashboard() {
        const activeVehicles = vehicleData.length;
        const alerts = vehicleData.filter(
          (v) => v.alert_level !== "normal"
        ).length;
        const avgSpeed =
          activeVehicles > 0
            ? Math.round(
                vehicleData.reduce((sum, v) => sum + v.speed, 0) /
                  activeVehicles
              )
            : 0;
        const avgPressure =
          activeVehicles > 0
            ? Math.round(
                vehicleData.reduce((sum, v) => sum + v.pressure, 0) /
                  activeVehicles
              )
            : 0;

        document.getElementById("activeVehicles").textContent = activeVehicles;
        document.getElementById("alertCount").textContent = alerts;
        document.getElementById("avgSpeed").textContent = avgSpeed;
        document.getElementById("avgPressure").textContent = avgPressure;

        const alertStatus = document.getElementById("alertStatus");
        if (alerts === 0) {
          alertStatus.textContent = "Kh√¥ng c√≥ c·∫£nh b√°o";
          alertStatus.className = "text-xs text-green-600 mt-1";
        } else {
          alertStatus.textContent = `${alerts} c·∫£nh b√°o ƒëang ho·∫°t ƒë·ªông`;
          alertStatus.className = "text-xs text-orange-600 mt-1";
        }
      }

      function updateVehicleTable() {
        /* ... gi·ªØ nguy√™n nh∆∞ file c·ªßa b·∫°n ... */
      }
      function updateVehicleGrid() {
        /* ... gi·ªØ nguy√™n ... */
      }
      function updateAlertsList() {
        /* ... gi·ªØ nguy√™n ... */
      }
      function updateHistoryFilters() {
        /* ... gi·ªØ nguy√™n ... */
      }
      function updateSettingsFilters() {
        /* ... gi·ªØ nguy√™n ... */
      }
      async function deleteVehicle(backendId) {
        /* ... gi·ªØ nguy√™n ... */
      }

      function saveThresholdSettings() {
        showToast("ƒê√£ l∆∞u c√†i ƒë·∫∑t ng∆∞·ª°ng c·∫£nh b√°o!", "success");
      }
      function saveNotificationSettings() {
        showToast("ƒê√£ l∆∞u c√†i ƒë·∫∑t th√¥ng b√°o!", "success");
      }

      function exportToCSV() {
        /* ... gi·ªØ nguy√™n nh∆∞ file b·∫°n ... */
      }

      function showToast(message, type = "success") {
        const toast = document.createElement("div");
        toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-semibold z-50 ${
          type === "success" ? "bg-green-500" : "bg-red-500"
        }`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.transition = "opacity 0.3s ease";
          setTimeout(() => document.body.removeChild(toast), 300);
        }, 3000);
      }

      window.deleteVehicle = deleteVehicle;

      initApp();
    </script>

    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'99d43c74339ea909',t:'MTc2MjkzMTcwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
